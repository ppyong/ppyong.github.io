---
layout: post
title: Spring은 왜 싱글톤으로 객체를 생성할까?
image: /img/hello_world.jpeg
---

일반적으로 Spring Framework에 대해서 공부하다보면 시작은 항상 Spring 이 객체를 (기본적으로)싱글톤으로 생성한다로 내용을 시작합니다. 
막연하게 왜 그럴 것이다라고 생각은 하고 있었지만 이번 기회에 정리하기 위해서 글을 작성합니다. 
위 궁금증을 설명하기에 앞서 관련된 내용을 먼저 설명하고자 합니다.     

Thread Safe란 의미를 아시나요? 
Thread Safe란 MultiThread 환경에서 함수, 변수, 객체등이 여러 Thread에서 동시에 접근하여도 어플리케이션의 실행에 이상이 생기지 않음을 의미합니다. 
Thread Safe 하게 어플리케이션을 개발하는 방법은 뭘까요? 

제일 기본적인 방법은 전역변수에 상태값을 가지고 있지 않는 것입니다. 물론 전역변수를 사용해도 여러 다양한 방법을 통해서 Thread Safe한 어플리케이션을 개발할 수 있지만 그에 따른 많은 신경을 써야합니다. 

그러면 Spring Bean은 기본적으로 싱글톤으로 객체를 생성한다 하였는데, Spring 의 Bean 역시도 Thread Safe 하지 않은거 아니야? 라고 생각할 수 있는데요. 
맞습니다. Spring 의 기본 설정으로 Bean을 등록하고 객체를 생성 시 해당 객체는 Heap 메모리에 생성되고 여러 Thread에서 사용될 수 있으므로 전역변수에 상태 값을 갖고 있을 경우 Thread Safe 하지 않을 수 있습니다. 

그럼 왜 이런 여러 고려 사항들을 갖고 있는 싱글톤을 Spring 은 기본 객체 생성 방식으로 선택한 것일까요? 

Spring을 사용하다보면 Spring이 데이터 객체가 아닌 비즈니스 로직을 개발하는데 많은 도움을 준다는 것을 알 수 있습니다. 
Entity 또는 단순 데이터를 갖고 있는 POJO는 Spring을 사용하여도 여전히 자기가 직접 관리하여야 하며 이런 객체들은 Spring 의 서비스, 컨트롤러, 레파지토리 등에 전달하여 사용하게 됩니다. 

이런 점을 생각해볼 때 Spring이 매 요청 시 객체를 새로 생성할 필요가 없단 것을 알 수 있습니다. 상태 값을 갖고 있지 않아 MultiThread 환경에서 안전하기에 굳이 객체를 매번 만들어서 사용함으로써 발생하는 불필요한 메모리 사용과 JVM GC를 유발할 필요가 없기 때문입니다. 

이런 이유로 Spring은 기본적으로 싱글턴을 사용하고 있습니다. 

그런데 한가지 의문이 생깁니다. 디자인패턴인 싱글톤 패턴은 안티패턴으로 알려져 있는데 Spring에서 안티패턴인 싱글톤 패턴을 왜 사용하는걸까요? 

일반적인 싱글톤 패턴과 Spring의 싱글톤은 차이가 있습니다. **정확하게는 같지 않습니다.**
디자인패턴의 싱글톤은 생성자를 private로 선언함으로서 인스턴스를 자유롭게 생성할 수 없게 제한하며 일반적으로 정적 메소드인 getInstance()를 통해 기존에 생성되어있는 인스턴스를 
제공하는 식으로 동작합니다. 이로인해 싱글톤 패턴은 클래스 로더 당 특정 클래스의 인스턴스가 하나만 생성될 것이다를 보장하게 됩니다. 

Spring의 싱글톤은 이와는 다르게 스프링 컨테이너(IoC 컨테이너) 당 같은 bean ID로 객체가 하나만 생성되는 것을 보장합니다. 만약 다른 bean ID를 사용한다면 동일한 클래스의 인스턴스를 여러개 생성할 수 있다는 것을 의미합니다. 또한 Spring에서 싱글톤을 사용하기 위해서 위 디자인패턴의 싱글톤처럼 생성자를 private로 선언할 필요가 없습니다. 

디자인패턴의 싱글톤을 사용할 경우 객체간의 결합도가 높아지게 되고 이런 결합도로 인해 OCP(개방폐쇠 원칙)을 위배하게 될 가능성이 높아집니다. 그외에도 코드를 테스트하기 어렵게 만듭니다.
이런 단점들을 갖고 있지 않은 Spring의 싱글톤은 많은 장점을 갖고 있다고 말할 수 있습니다. 

*이정도면 Spring이 기본 객체 관리를 싱글톤으로 하는 이유가 설명되지 않을까요?*








